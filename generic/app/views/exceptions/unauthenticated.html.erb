<form action="<%= slice_url(:merb_auth_slice_password, :perform_login) %>" method="POST" accept-charset="utf-8">
  <fieldset class="logbox"><input type="hidden" name="_method" value="PUT" />
  <h3>Login</h3>
  <%= error_messages_for session.authentication %>
  <% @login_param = Merb::Authentication::Strategies::Multisite::Base.login_param %>
  <% @password_param = Merb::Authentication::Strategies::Multisite::Base.password_param %>
  <% @site_id_param = Merb::Authentication::Strategies::Multisite::Base.site_id_param %>
	
	<% # make @current_site value. application.rb does not get call because the authentication is protected at the rack level - which is better, but it means I have to add the following code. %>
	<% if (request.first_subdomain != "") && (request.first_subdomain == "admin") %>
        <% @current_school = School.find(:first, :conditions => ['subdomain = ?', request.first_subdomain ] ) %>
  <% elsif (request.first_subdomain != "") && (request.first_subdomain != "admin") %>
        <% @current_school = School.find(:first, :conditions => ['subdomain = ?', request.first_subdomain ] ) %>
  <% else %>
        <% @current_school = School.first(:domain => request.domain) %>
  <% end %>
  <input type="hidden" name="<%= @site_id_param.to_s %>" value="<%= @current_school.id %>" id="<%= @site_id_param.to_s %>">
  <ul>
    <li>
      <label class="short"><%= @login_param.to_s.capitalize %>:</label>
      <input type="text" class="text" name="<%= @login_param.to_s %>" value="" id="<%= @login_param.to_s %>">
    </li>
    <li>
      <label class="short"><%= @password_param.to_s.capitalize %>:</label>
      <input type="password" class="text" name="<%= @password_param.to_s %>" value="" id="<%= @password_param.to_s %>">
    </li>
    <li>
      <label class="short">&nbsp;</label>
      <input type="submit" name="Submit" value="Log In" id="Submit">
    </li>
    <li class="reg-forgot">
      <label class="short">&nbsp;</label>
      <% unless (request.first_subdomain == "admin") %>
        <span><%= link_to "Register Here", resource(:registrations, :new) %></span>
      <% end %>
      <span><%= link_to "Forgot Password", url(:forgot_password) %></span>
    </li>
  </ul>
  </fieldset>
</form>