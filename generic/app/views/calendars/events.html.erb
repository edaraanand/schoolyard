<div class="short-block">
  <h2 class="current-page"> All Events </h2>

  <%= form_for(@calendar, :action => url(:events), :method => 'get') do %>
   
      <span class="select-announce"><%= select :name => "class_name", :collection => @classrooms %><%= submit ">>" %></span>
     
  <% end =%> 

<% if params[:class_name].nil? %>

       <% for calendar in @cals %>
            <div class="calendar-block" style="width:480px;">
               <% unless calendar.start_date.nil? %> 
                   <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
               <% end %>
               <% cals = @cals.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
               <ul class="calendar-items">
                   <% cals.each do |cal| %>
                        <li>
                            <span class="cal-time">
                                 <% unless cal.start_time.nil? %>
                                       <%= cal.start_time.strftime("%H-%M") %>
                                 <% end %>
                                 &nbsp;
                            </span>
                            <span class="cal-title">
                                  <%= cal.title %>
                            </span>
                        </li>
                        <%# @calendars.delete_if{|c| c.start_date.to_date == cal.start_date.to_date } %>
                        <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
                   <% end %>
                </ul>
             </div>
                  <% @cals.delete_if{|c| cals.include?(c)} %>
                  <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
      <% end %>
  
<% elsif params[:class_name] == "All Events" %>

          <% for calendar in @calendars %>
                  <div class="calendar-block" style="width:480px;">
                        <% unless calendar.start_date.nil? %> 
                              <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
                        <% end %>
                        <% cals = @calendars.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
                        <ul class="calendar-items">
                              <% cals.each do |cal| %>
                                    <li>
                                        <span class="cal-time">
                                              <% unless cal.start_time.nil? %>
                                                     <%= cal.start_time.strftime("%H-%M") %>
                                              <% end %>
                                                &nbsp;
                                         </span>
                                         <span class="cal-title">
                                               <%= cal.title %>
                                         </span>
                                     </li>
                                     <%# @calendars.delete_if{|c| c.start_date.to_date == cal.start_date.to_date } %>
                                     <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
                               <% end %>
                         </ul>
                 </div>
                    <% @calendars.delete_if{|c| cals.include?(c)} %>
                    <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
           <% end %>
<% else %>

           <% for calendar in @cls %>
                  <div class="calendar-block" style="width:480px;">
                        <% unless calendar.start_date.nil? %> 
                               <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
                        <% end %>
                        <% cals = @cls.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
                        <ul class="calendar-items">
                             <% cals.each do |cal| %>
                                     <li>
                                         <span class="cal-time">
                                                <% unless cal.start_time.nil? %>
                                                      <%= cal.start_time.strftime("%H-%M") %>
                                                <% end %>
                                                 &nbsp;
                                         </span>
                                         <span class="cal-title">
                                                <%= cal.title %>
                                         </span>
                                     </li>
                                     <%# @calendars.delete_if{|c| c.start_date.to_date == cal.start_date.to_date } %>
                                     <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
                             <% end %>
                        </ul>
                  </div>
                        <% @cls.delete_if{|c| cals.include?(c)} %>
                        <%# @calendars.delete_if{|key, value| value == cal.start_date } %>
          <% end %>
  
<% end %> 
</div>
