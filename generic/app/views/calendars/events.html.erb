<div class="short-block">
    <% if params[:class_name].nil? %>
         <h2 class="current-page"> All Events </h2>
    <% elsif params[:class_name] == "All Events" %>
          <h2 class="current-page"> All Events </h2>
     <% else %> 
          <h2 class="current-page"> Events for <%= params[:class_name] %> </h2>
     <% end %>
     
  <%= form_for(@calendar, :action => url(:events), :method => 'get') do %>
  
  <% if params[:class_name].nil? %>
  <span class="select-announce"><%= select :name => "class_name", :collection => @classrooms, :label => "View :" %><%= submit "Go" %></span>
  <% else %>
      <span class="select-announce"><%= select :name => "class_name", :selected => params[:class_name], :collection => @classrooms, :label => "View :" %><%= submit "Go" %></span>
  <% end %>
<% end =%> 

<% if params[:class_name].nil? %>

        <% for calendar in @cals %>
               <div class="calendar-block" style="width:480px;">
                       <% unless calendar.start_date.nil? %> 
                            <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
                       <% end %>
                       <% cals = @cals.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
                     <ul class="calendar-items">
                           <% cals.each do |cal| %>
                                  <li>
                                      <span class="cal-time">
                                            <% unless cal.start_time.nil? %>
                                                 <%= cal.start_time.strftime("%H-%M") %>
                                            <% end %>&nbsp;
                                      </span>
                                      <span class="cal-title">
                                            <%= cal.title %>
                                      </span>
                                      <span class="cal-time">
                                            <% unless cal.end_time.nil? %>
                                                 Ends at <%= cal.end_time.strftime("%H-%M") %>
                                            <% end %>  &nbsp;
                                      </span>
                                      <% @attachment = Attachment.find(:first, :conditions => ['attachable_id=?', cal.id] ) %>
                                       <% unless @attachment.nil? %>
                                            <p><%= link_to "#{@attachment.filename}", url(:download, :id => @attachment.id) %></p>
                                       <% end %>
                                   </li>
                           <% end %>
                     </ul>
                </div>
                
                   <% @cals.delete_if{|c| c.start_date == calendar.start_date } %>
                  
      <% end %>
  
<% elsif params[:class_name] == "All Events" %>

          <% for calendar in @calendars %>
                  <div class="calendar-block" style="width:480px;">
                        <% unless calendar.start_date.nil? %> 
                              <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
                        <% end %>
                        <% cals = @calendars.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
                        <ul class="calendar-items">
                              <% cals.each do |cal| %>
                                    <li>
                                        <span class="cal-time">
                                              <% unless cal.start_time.nil? %>
                                                     <%= cal.start_time.strftime("%H-%M") %>
                                              <% end %>
                                                &nbsp;
                                         </span>
                                         <span class="cal-title">
                                               <%= cal.title %>
                                         </span>
                                         <span class="cal-time">
                                            <% unless cal.end_time.nil? %>
                                                 Ends at <%= cal.end_time.strftime("%H-%M") %>
                                            <% end %>  &nbsp;
                                         </span>
                                        <% @attachment = Attachment.find(:first, :conditions => ['attachable_id=?', cal.id] ) %>
                                        <% unless @attachment.nil? %>
                                             <p><%= link_to "#{@attachment.filename}", url(:download, :id => @attachment.id) %></p>
                                        <% end %>
                                     </li>
                              <% end %>
                         </ul>
                 </div>
                   <% @calendars.delete_if{|c| c.start_date == calendar.start_date } %>
                   
           <% end %>
<% else %>

           <% for calendar in @cls %>
                  <div class="calendar-block" style="width:480px;">
                        <% unless calendar.start_date.nil? %> 
                               <h3><%= calendar.start_date.strftime("%B-%d") %></h3>
                        <% end %>
                        <% cals = @cls.select{|c| c.start_date.to_date == calendar.start_date.to_date } %>
                        <ul class="calendar-items">
                             <% cals.each do |cal| %>
                                     <li>
                                         <span class="cal-time">
                                                <% unless cal.start_time.nil? %>
                                                      <%= cal.start_time.strftime("%H-%M") %>
                                                <% end %>
                                                 &nbsp;
                                         </span>
                                         <span class="cal-title">
                                                <%= cal.title %>
                                         </span>
                                         <span class="cal-time">
                                            <% unless cal.end_time.nil? %>
                                                 Ends at <%= cal.end_time.strftime("%H-%M") %>
                                            <% end %>  &nbsp;
                                         </span>
                                        <% @attachment = Attachment.find(:first, :conditions => ['attachable_id=?', cal.id] ) %>
                                        <% unless @attachment.nil? %>
                                             <p><%= link_to "#{@attachment.filename}", url(:download, :id => @attachment.id) %></p>
                                        <% end %>
                                     </li>
                                    
                             <% end %>
                        </ul>
                  </div>
                        <% @cls.delete_if{|c| c.start_date == calendar.start_date } %>
          <% end %>
  
<% end %> 
</div>
