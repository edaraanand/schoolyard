<div>
<ul class='error_messages'>
     <% if flash[:error] %>
        <li><%= flash[:error] %> </li>
     <% end %>
</ul>
 </div>
<h2 class="current-page">Parent Registrations </h2>

  
<div class="">
  
    <dl>
       <dt>Name</dt>
       <dd> <%= @parent.name %></dd>
    </dl>
    <dl>
       <dt class="separator">Email:</dt>
       <dd class="separator"> <%= @parent.email %></dd>
    </dl>
     <br class="clear"/>
    <h3> Student Details :</h3>  
            
      
  <%= form_for :parent, :action => url(:parent_grant, :id => @parent), :name => "approveform" do %> 

      <% @registrations.each do |f| %>
             
         <% @class = Classroom.find(:first, :conditions => ['class_name = ?', f.current_class ] ) %> 
           
         <% @studs = Student.find( :all, :joins => :studies, 
                                   :conditions => ["first_name = ? AND last_name = ? AND birth_date = ? AND studies.classroom_id = ?", 
	                                               f.first_name, f.last_name, f.birth_date, @class.id ] ) %>
             
            <% if @studs.empty? %>
                 <br class="clear"/>
                 <div>
                       <span class="reject"><%= @not_exist %></span><br/>                                                                                                                                                          
                       Please select the student &amp; class to map this parent to:<br/>
                    <% if params[:label]   %>
                           <% if params[:label] != "" %>
                              <dd>
                                <%= select :name => "class_not_found[]",  :prompt => "Classroom - Please Select", 
                                   :collection => @classrooms.collect{|x| x.class_name }, :selected => @room.class_name, 
                                   :onchange => "javascript:window.location.href='/approval_review?label='+(this.value)+'&id=#{f.parent_id}'" %>
                              </dd>
                           <% else %>
                                  <dd>   
	                                 <%= select :name => "class_not_found[]",  :prompt => "Classroom - Please Select", 
				                           :collection => @classrooms.collect{|x| x.class_name }, 
				                       :onchange => "javascript:window.location.href='/approval_review?label='+(this.value)+'&id=#{f.parent_id}'" %>
				                 </dd>
                           <% end %>
                    <% else %>
                 <dd>         <%= select :name => "class_not_found[]",  :prompt => "Classroom - Please Select", 
                                  :collection => @classrooms.collect{|x| x.class_name }, 
                                  :onchange => "javascript:window.location.href='/approval_review?label='+(this.value)+'&id=#{f.parent_id}'" %>
                 </dd>
                    <% end %>
                 <dd> 
                       <%= select :name => "student_not_found[]", :prompt => "Student - Please Select",
                                  :collection => @students.collect{|x| x.name } %>
                 </dd>
            <% else %>
                   <dt></dt>
                   <dd><%= @exist %></dd>
                   <dd><%= select :name => "class_found[]", :prompt => "Classroom - Please Select", 
                                  :collection => @classrooms.collect{|x| x.class_name } %>
                   </dd>
                   <dd><%= select :name => "student_found[]", :prompt => "Student - Please Select", 
                                  :collection => @students.collect{|x| x.name } %></dd>
            <% end %> 
               <br/><br/><br/>
               <h4 style="clear:both"><b>Details entered by the parent</b></h4>
               <dl>                                                                                        
                  <dt>Name</dt>
                  <dd> <%= f.name %> </dd>
               </dl>
           
          <dl> 
             <dt>Current Class</dt>
             <dd><%= f.current_class.titleize %> </dd>
          </dl> 
          <dl> 
              <dt>Date of Birth</dt>
              <dd><%= f.birth_date.strftime("%B %d %Y") %> </dd>
          </dl> 
            
     <% end %>
   
      <hr size="1"  class="clear"/>
      <br/><br/>
            <input type="hidden" name="approvetype" />
            <a href="javascript:getsupport('Approve &amp; Grant Access')" class="reactive">Approve &amp; Grant Access </a>
            <br />
            <br />
            &nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:getsupport('Reject')" class="deactive">Reject</a> 
      </div>
      
 
  <% end =%>   
    
       
</div>
   
  
<script language="JavaScript" type="text/javascript">

   function getsupport ( selectedtype )
   {
      document.approveform.approvetype.value = selectedtype ;
      document.approveform.submit() ;
    }

</script> 
